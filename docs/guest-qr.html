<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Guest QR Copy</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="page-shell">
    <section class="gallery-card">
      <header class="gallery-head">
        <a class="back-link" href="index.html">&larr; Back</a>
        <h1 class="page-title">Guest QR Copy</h1>
        <p class="photo-count">Share</p>
      </header>

      <section class="qr-grid" aria-label="Guest QR codes">
        <article class="qr-page-card">
          <p class="tools-title">Gallery QR</p>
          <img id="guestGalleryQr" class="qr-image" alt="QR code for gallery">
          <a id="guestGalleryLink" class="gallery-link" target="_blank" rel="noopener noreferrer"></a>
        </article>

        <article class="qr-page-card">
          <p class="tools-title">Dashboard QR</p>
          <img id="guestDashboardQr" class="qr-image" alt="QR code for dashboard">
          <a id="guestDashboardLink" class="gallery-link" target="_blank" rel="noopener noreferrer"></a>
        </article>

        <article class="qr-page-card">
          <p class="tools-title">Celebrate with Us!!!</p>
          <img id="guestGithubQr" class="qr-image" alt="QR code for GitHub link">
          <a id="guestGithubLink" class="gallery-link" target="_blank" rel="noopener noreferrer"></a>
        </article>
      </section>
    </section>
  </main>

  <script src="config.js"></script>
  <script>
    function getPublicBaseUrl() {
      const configured = String(window.PUBLIC_SITE_URL || "").trim();
      if (configured) return configured.replace(/\/+$/, "");

      const host = window.location.hostname;
      const isLocalhost = host === "localhost" || host === "127.0.0.1" || host === "::1";
      if (isLocalhost) return "";
      return window.location.origin.replace(/\/+$/, "");
    }

    function setQr(imgId, linkId, targetPath) {
      const img = document.getElementById(imgId);
      const link = document.getElementById(linkId);
      if (!img || !link) return;

      const publicBaseUrl = getPublicBaseUrl();
      if (!publicBaseUrl) {
        img.removeAttribute("src");
        link.removeAttribute("href");
        link.textContent = "Set window.PUBLIC_SITE_URL in config.js to generate a public QR link.";
        return;
      }

      const targetUrl = new URL(targetPath, `${publicBaseUrl}/`).toString();
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(targetUrl)}`;

      img.src = qrUrl;
      link.href = targetUrl;
      link.textContent = targetUrl;
    }

    function setAbsoluteQr(imgId, linkId, absoluteUrl) {
      const img = document.getElementById(imgId);
      const link = document.getElementById(linkId);
      if (!img || !link) return;

      const cleanUrl = String(absoluteUrl || "").trim();
      if (!cleanUrl) {
        img.removeAttribute("src");
        link.removeAttribute("href");
        link.textContent = "Set window.GITHUB_SITE_URL in config.js.";
        return;
      }

      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodeURIComponent(cleanUrl)}`;
      img.src = qrUrl;
      link.href = cleanUrl;
      link.textContent = cleanUrl;
    }

    setQr("guestGalleryQr", "guestGalleryLink", "gallery.html");
    setQr("guestDashboardQr", "guestDashboardLink", "index.html");
    setAbsoluteQr("guestGithubQr", "guestGithubLink", window.GITHUB_SITE_URL);
  </script>
</body>
</html>
